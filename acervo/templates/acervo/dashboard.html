{% extends 'acervo/base.html' %}

{% block title %}Dashboard - Sistema Biblioteca{% endblock %}

{% block content %}
<style>
    .grid-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 40px; }
    .stat-card { padding: 20px; border-radius: 10px; color: white; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .bg-blue { background: #3498db; }
    .bg-green { background: #2ecc71; }
    .bg-orange { background: #e67e22; }
    .bg-purple { background: #9b59b6; }
    .bg-red { background: #e74c3c; } 
    .stat-card h2 { font-size: 2.5em; margin: 10px 0; }
    
    .btn-acao { 
        display: inline-block; padding: 12px 20px; background: #2c3e50; color: white; 
        text-decoration: none; border-radius: 5px; font-weight: bold; margin-right: 10px; margin-bottom: 10px;
    }
    .btn-acao:hover {  background: #3498db !important; }

    .alerta-atraso { border-left: 5px solid #e74c3c; background-color: #fdf2f2; margin-bottom: 30px; }
    
</style>

<h1>Painel de Controle</h1>

<div class="grid-stats">
    <div class="stat-card bg-blue">
        <p>Total de Livros</p>
        <h2>{{ total_livros }}</h2>
    </div>
    <div class="stat-card bg-green">
        <p>Dispon√≠veis</p>
        <h2>{{ livros_disponiveis }}</h2>
    </div>
    <div class="stat-card bg-orange">
        <p>Emprestados</p>
        <h2>{{ livros_emprestados }}</h2>
    </div>
    <div class="stat-card bg-red">
        <p>Em Atraso</p>
        <h2>{{ total_atrasados }}</h2>
    </div>
    <div class="stat-card bg-purple">
        <p>Usu√°rios</p>
        <h2>{{ total_usuarios }}</h2>
    </div>
</div>

{% if total_atrasados > 0 %}
<div class="card alerta-atraso">
    <h2 style="color: #c0392b; margin-top: 0;">Devolu√ß√µes Pendentes</h2>
    <table style="width: 100%;">
        <thead>
            <tr style="text-align: left;">
                <th>Livro</th>
                <th>Usu√°rio</th>
                <th>Venceu em</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for emp in atrasados %}
            <tr>
                <td><strong>{{ emp.livro.titulo }}</strong></td>
                <td>{{ emp.usuario.nome }}</td>
                <td style="color: #e74c3c; font-weight: bold;">{{ emp.data_previsao_devolucao|date:"d/m/Y" }}</td>
                <td>
                    <a href="/admin/acervo/emprestimo/{{ emp.id }}/change/" target="_blank" style="color: #3498db;">Reagendar / Dar Baixa</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div class="card">
    <h2>A√ß√µes R√°pidas</h2>
        
    <a href="/admin/acervo/livro/add/" target="_blank" class="btn-acao" style="background: #27ae60;">‚ûï Cadastrar Livro</a>
    <a href="/admin/acervo/usuario/add/" target="_blank" class="btn-acao" style="background: #2980b9;">üë§ Cadastrar Usu√°rio</a>
    <a href="/admin/acervo/emprestimo/add/" target="_blank" class="btn-acao" style="background: #8e44ad;">üìñ Novo Empr√©stimo</a>
    <a href="{% url 'livros_emprestados' %}" class="btn-acao" style="background: #BA8E23;">üìï Baixar Empr√©stimo</a>
    

</div>

<div class="card" style="margin-top: 20px;">
    <h2>√öltimas Movimenta√ß√µes</h2>
    <table>
        <thead>
            <tr>
                <th>Livro</th>
                <th>Usu√°rio</th>
                <th>Data de Sa√≠da</th>
            </tr>
        </thead>
        <tbody>
            {% for emp in ultimos_emprestimos %}
            <tr>
                <td>{{ emp.livro.titulo }}</td>
                <td>{{ emp.usuario.nome }}</td>
                <td>{{ emp.data_saida|date:"d/m/Y" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="3">Nenhuma movimenta√ß√£o recente.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}