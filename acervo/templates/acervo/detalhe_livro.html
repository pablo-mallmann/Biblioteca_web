{% extends 'acervo/base.html' %}

{% block title %}{{ livro.titulo }} - Detalhes{% endblock %}

{% block content %}
<style>
    
    .detalhe-flex { display: flex; gap: 30px; margin-top: 20px; }
    .capa-img { max-width: 250px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .info-detalhada { flex: 1; }
    .status-badge { padding: 5px 10px; border-radius: 4px; font-weight: bold; background: #eee; }
    .voltar-link { display: inline-block; margin-bottom: 20px; text-decoration: none; color: #007bff; }
    .tabela-historico { margin-top: 30px; }

    .btn-gerenciar { 
        color: #3498db; 
        text-decoration: none; 
        font-weight: bold; 
        border: 1px solid #3498db; 
        padding: 3px 8px; 
        border-radius: 4px; 
        font-size: 0.9em;
    }
    .btn-gerenciar:hover { background: #3498db; color: white; }
</style>

<a href="{% url 'lista_livros' %}" class="voltar-link">← Voltar para a lista</a>

<div class="detalhe-flex">
    <div>
        {% if livro.capa %}
            <img src="{{ livro.capa.url }}" alt="Capa de {{ livro.titulo }}" class="capa-img">
        {% else %}
            <div style="width:200px; height:300px; background:#ddd; display:flex; align-items:center; justify-content:center; border-radius:8px;">
                Sem Capa
            </div>
        {% endif %}
    </div>
    
    <div class="info-detalhada">
        <h1>{{ livro.titulo }}</h1>
        <p><strong>ID:</strong> {{ livro.id }}</p>
        <p><strong>Autor:</strong> {{ livro.autor }}</p>
        <p><strong>Editora:</strong> {{ livro.editora }} | <strong>Gênero:</strong> {{ livro.genero }}</p>
        
        {% if livro.observacao %}
            <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 4px; border-left: 4px solid #ffc107;">
                <strong>Observação:</strong> {{ livro.observacao }}
            </div>
        {% endif %}
        
        <p><strong>Status Atual:</strong> <span class="status-badge">{{ livro.status }}</span></p>
    </div>
</div>

<hr class="tabela-historico">
<h2>Histórico de Movimentação</h2>

<table>
    <thead>
        <tr>
            <th>Usuário</th>
            <th>Data de Saída</th>
            <th>Previsão de Devolução</th>
            <th>Data de Devolução Real</th>
            <th>Ação</th> </tr>
    </thead>
    <tbody>
        {% for registro in historico %}
        <tr>
            <td>{{ registro.usuario.nome }}</td>
            <td>{{ registro.data_saida|date:"d/m/Y" }}</td>
            <td>{{ registro.data_previsao_devolucao|date:"d/m/Y" }}</td>
            <td>
                {% if registro.data_devolucao_real %}
                    {{ registro.data_devolucao_real|date:"d/m/Y" }}
                {% else %}
                    <span style="color: orange; font-weight: bold;">Ainda em posse</span>
                {% endif %}
            </td>
            <td>
                <a href="/admin/acervo/emprestimo/{{ registro.id }}/change/" target="_blank" class="btn-gerenciar">
                    ⚙️ Gerenciar
                </a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" style="text-align: center;">Este livro nunca foi retirado.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}